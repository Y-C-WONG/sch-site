---
import Layout from '../../layouts/Layout.astro'
import Header from '../../components/Header.astro'
import Footer from '../../components/Footer.astro'
import Hero from '../../components/Hero.astro'

const allPosts = await Astro.glob('./posts/*.{md,mdx}');

const publishedPosts = allPosts
  .filter(post => !post.frontmatter.draft)
  .sort((a, b) => new Date(b.frontmatter.publishDate).getTime() - new Date(a.frontmatter.publishDate).getTime());
---

<Layout 
  title="Blog - International School" 
  description="Stay updated with the latest blog posts, insights, and stories from our school community. Discover educational content, student achievements, and school activities."
>
  <Header />
  
  <!-- Hero Section -->
  <Hero 
    title="School Blog"
    subtitle="Stories & Insights"
    description="Explore our collection of blog posts featuring educational insights, student stories, and community highlights from International School."
    backgroundImage="/images/hero-school-wider.png"
  />

  <!-- Main Content -->
  <section class="py-16 bg-gray-50">
    <div class="mx-auto max-w-screen-2xl px-4 sm:px-6 lg:px-8">
      
      <!-- Blog Posts -->
      <div class="max-w-4xl mx-auto">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900">Latest Blog Posts</h2>
        </div>
        
        <div class="space-y-8">
          {/* First post spans full width if featured */}
          {publishedPosts.length > 0 && (
            <div>
              <article class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
                <div class="p-8">
                  <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                      <h2 class="text-3xl font-bold text-gray-900 mb-3">
                        <a href={publishedPosts[0].url} class="hover:text-primary-600 transition-colors">
                          {publishedPosts[0].frontmatter.title}
                        </a>
                      </h2>
                      <p class="text-lg text-gray-600 mb-4">{publishedPosts[0].frontmatter.description}</p>
                    </div>
                  </div>
                  
                  <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                    <div class="flex items-center space-x-4">
                      <span>By {publishedPosts[0].frontmatter.author}</span>
                      <span>•</span>
                      <time datetime={publishedPosts[0].frontmatter.publishDate}>
                        {new Date(publishedPosts[0].frontmatter.publishDate).toLocaleDateString('en-US', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric'
                        })}
                      </time>
                    </div>
                    
                    {publishedPosts[0].frontmatter.tags && (
                      <div class="flex space-x-2">
                        {publishedPosts[0].frontmatter.tags.map((tag) => (
                          <span class="px-3 py-1 bg-primary-100 text-primary-800 text-xs rounded-full">
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                  
                  <div>
                    <a 
                      href={publishedPosts[0].url} 
                      class="text-primary-600 hover:text-primary-700 font-medium inline-flex items-center"
                    >
                      Read more
                      <svg class="ml-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </article>
            </div>
          )}
          
          {/* Remaining posts in 2-column grid */}
          {publishedPosts.length > 1 && (
            <div class="grid md:grid-cols-2 gap-8">
              {publishedPosts.slice(1).map((post) => (
                <article class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
                  <div class="p-6">
                    <div class="mb-4">
                      <h3 class="text-xl font-bold text-gray-900 mb-2">
                        <a href={post.url} class="hover:text-primary-600 transition-colors">
                          {post.frontmatter.title}
                        </a>
                      </h3>
                      <p class="text-gray-600 mb-4">{post.frontmatter.description}</p>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                      <div class="flex items-center space-x-2">
                        <span>By {post.frontmatter.author}</span>
                        <span>•</span>
                        <time datetime={post.frontmatter.publishDate}>
                          {new Date(post.frontmatter.publishDate).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                          })}
                        </time>
                      </div>
                    </div>

                    {post.frontmatter.tags && (
                      <div class="flex flex-wrap gap-1 mb-4">
                        {post.frontmatter.tags.map((tag) => (
                          <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                    
                    <div>
                      <a 
                        href={post.url} 
                        class="text-primary-600 hover:text-primary-700 font-medium inline-flex items-center text-sm"
                      >
                        Read more
                        <svg class="ml-1 w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                      </a>
                    </div>
                  </div>
                </article>
              ))}
            </div>
          )}
        </div>
        
        {publishedPosts.length === 0 && (
          <div class="text-center py-16">
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No blog posts yet</h3>
            <p class="text-gray-500">Check back soon for updates and stories from our school community!</p>
          </div>
        )}
      </div>
    </div>
  </section>

  <Footer />
</Layout>